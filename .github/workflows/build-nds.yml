name: Build NDS Examples

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    - name: Set up devkitPro
      run: |
        sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 4D2C4B5A
        echo "deb https://apt.devkitpro.org/ stable main" | sudo tee /etc/apt/sources.list.d/devkitpro.list
        sudo apt-get update
        sudo apt-get install -y devkitarm libnds nds-dev

    - name: Build All Examples
      run: |
        for d in */ ; do
          if [ -f "$d/Makefile" ]; then
            make -C "$d" || echo "Failed to build $d"
          fi
        done

    - name: Upload Artifacts
      uses: actions/upload-artifact@v4
      with:
        name: nds-builds
        path: |
          **/*.nds
