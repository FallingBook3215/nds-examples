name: Build DS ROM

on:
  push:
    paths:
      - 'sprite_test/**'
      - '.github/workflows/build-nds.yml'
  pull_request:
    paths:
      - 'sprite_test/**'
      - '.github/workflows/build-nds.yml'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install devkitPro
        run: |
          sudo add-apt-repository ppa:devkitpro/ppa -y
          sudo apt-get update
          sudo apt-get install devkitpro-pacman -y
          sudo dkp-pacman -Sy --noconfirm devkitARM libnds grit

      - name: Set devkitPro env
        run: |
          echo "DEVKITPRO=/opt/devkitpro" >> $GITHUB_ENV
          echo "DEVKITARM=/opt/devkitpro/devkitARM" >> $GITHUB_ENV
          echo "/opt/devkitpro/devkitARM/bin" >> $GITHUB_PATH

      - name: Build sprite_test NDS
        working-directory: sprite_test
        run: make

      - name: Upload ROM artifact
        uses: actions/upload-artifact@v4
        with:
          name: sprite_test-nds
          path: sprite_test/sprite_test.nds
